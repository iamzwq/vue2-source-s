{"version":3,"file":"vue.js","sources":["../src/observe/array.js","../src/observe/index.js","../src/state.js","../src/init.js","../src/index.js"],"sourcesContent":["// 重写数组的部分方法\r\nconst oldArrayProto = Array.prototype;\r\n\r\n// newArrayProto.__proto__ = oldArrayProto\r\nexport const newArrayProto = Object.create(oldArrayProto);\r\n\r\nconst methods = [\r\n\t// 可以改变原数组的方法\r\n\t\"push\",\r\n\t\"pop\",\r\n\t\"shift\",\r\n\t\"unshift\",\r\n\t\"reverse\",\r\n\t\"sort\",\r\n\t\"slpice\",\r\n];\r\n\r\nmethods.forEach(method => {\r\n\tnewArrayProto[method] = function (...args) {\r\n\t\tconst result = oldArrayProto[method].call(this, ...args);\r\n\r\n    const ob = this.__ob__;\r\n\r\n\t\t// 对数组新增的值进行劫持\r\n\t\tlet inserted;\r\n\t\tswitch (method) {\r\n\t\t\tcase \"push\":\r\n\t\t\tcase \"unshift\":\r\n\t\t\t\tinserted = args;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"splice\": // arr.splice(index, howmany, {a: 1}, {a: 1})\r\n\t\t\t\tinserted = args.slice(2);\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n    if (inserted) { // 如果存在新增值，进行劫持\r\n      ob.observeArray(inserted)\r\n    }\r\n\r\n    return result\r\n\t};\r\n});\r\n","import { newArrayProto } from \"./array\";\r\n\r\nclass Observe {\r\n\tconstructor(data) {\r\n\t\t// 这里添加属性 '__ob__' 带来的好处有两个\r\n\t\t// 1、是为了把Observe的实例的原型方法放到数据上，这样./array.js里面重写的数组方法中新增的数据劫持可以能调用obseveArray方法\r\n\t\t// 2、可以作为判断对象是否被劫持过\r\n\t\t// data.__ob__ = this; // 这么写会造成死循环，因为如果data是对象的话会新增一个—__ob__属性，在下面的defineReactive中会造成死循环，所以可以将这个属性设置为不可枚举，如下写法：\r\n\t\tObject.defineProperty(data, \"__ob__\", {\r\n\t\t\tvalue: this,\r\n\t\t\tenumerable: false,\r\n\t\t});\r\n\r\n\t\tif (Array.isArray(data)) {\r\n\t\t\tdata.__proto__ = newArrayProto; // 需要保留数组的特性，并且可以重写部分方法\r\n\t\t\tthis.observeArray(data); // 如果数组中存在对象，需劫持\r\n\t\t} else {\r\n\t\t\tthis.walk(data);\r\n\t\t}\r\n\t}\r\n\r\n\twalk(data) {\r\n\t\tObject.keys(data).forEach(key => defineReactive(data, key, data[key]));\r\n\t}\r\n\r\n\tobserveArray(data) {\r\n\t\tdata.forEach(item => observe(item));\r\n\t}\r\n}\r\n\r\nexport function defineReactive(target, key, value) {\r\n\t// 如果value是对象，递归劫持\r\n\tobserve(value);\r\n\r\n\t// \"重新定义\"属性 比较耗性能\r\n\tObject.defineProperty(target, key, {\r\n\t\tget() {\r\n\t\t\treturn value;\r\n\t\t},\r\n\t\tset(newValue) {\r\n\t\t\tif (newValue === value) return;\r\n\r\n\t\t\tobserve(newValue); // 设置值的时候如果是对象也进行递归劫持\r\n\r\n\t\t\tvalue = newValue;\r\n\t\t},\r\n\t});\r\n}\r\n\r\nexport function observe(data) {\r\n\tif (typeof data !== \"object\" || data === null) return;\r\n\r\n\t// 判断是否已经被劫持过\r\n\tif (data.__ob__ instanceof Observe) {\r\n\t\treturn data.__ob__;\r\n\t}\r\n\r\n\t// 只对没有被劫持的对象做劫持\r\n\treturn new Observe(data);\r\n}\r\n","import { observe } from \"./observe/index\";\r\n\r\nexport function initState(vm) {\r\n\tconst opts = vm.$options;\r\n\r\n\t// if (opts.props) {}\r\n\r\n\tif (opts.data) {\r\n\t\tinitData(vm);\r\n\t}\r\n\r\n\t// if (opts.computed) {}\r\n}\r\n\r\nfunction initData(vm) {\r\n\tlet data = vm.$options.data;\r\n\r\n\tdata = typeof data === \"function\" ? data.call(vm) : data;\r\n\r\n\tvm._data = data;\r\n\r\n\tobserve(data);\r\n\r\n  // 将vm._data用vm来代理\r\n\tfor (const key in data) {\r\n\t\tproxy(vm, \"_data\", key);\r\n\t}\r\n}\r\n\r\nfunction proxy(vm, target, key) {\r\n\tObject.defineProperty(vm, key, { // vm.name\r\n\t\tget() {\r\n\t\t\treturn vm[target][key]; // vm._data.name\r\n\t\t},\r\n\t\tset(newValue) {\r\n\t\t\tvm[target][key] = newValue;\r\n\t\t},\r\n\t});\r\n}\r\n","import { initState } from \"./state\";\r\n\r\nexport function initMixin(Vue) {\r\n\tVue.prototype._init = function (options) {\r\n\t\tconst vm = this;\r\n\r\n\t\tvm.$options = options;\r\n\r\n\t\t// 初始化状态\r\n\t\tinitState(vm);\r\n\t};\r\n}\r\n","import { initMixin } from \"./init\";\r\n\r\n// 声明Vue构造函数\r\nfunction Vue(options) {\r\n  // 这里调用的实例方法都在下面扩展来的\r\n\tthis._init(options);\r\n}\r\n\r\n// 扩展Vue的原型方法\r\ninitMixin(Vue); // 扩展初始化方法\r\n\r\nexport default Vue;\r\n"],"names":["oldArrayProto","Array","prototype","newArrayProto","Object","create","methods","forEach","method","args","result","call","ob","__ob__","inserted","slice","observeArray","Observe","data","defineProperty","value","enumerable","isArray","__proto__","walk","keys","key","defineReactive","item","observe","target","get","set","newValue","initState","vm","opts","$options","initData","_data","proxy","initMixin","Vue","_init","options"],"mappings":"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"}